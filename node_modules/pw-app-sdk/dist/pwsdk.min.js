!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.PWSDK=t()}(this,function(){"use strict";var e=Object.assign||function(e){for(var t,o=1,n=arguments.length;n>o;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},t=function(){function e(){var e=this;this.resolve=function(t){e._resolve(t)},this.reject=function(t){e._reject(t)},this._promise=new Promise(function(t,o){e._resolve=t,e._reject=o})}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),e}();function o(e,t){void 0===t&&(t=""),t||(t=window.location.href),e=e.replace(/[[]]/g,"\\$&");var o=RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return o&&o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):""}return function(){function n(e,t){var o=this;if(this.origin=e,this.instanceId=t,this.deferred={},this.events={},window.top===window)throw Error("PWSDK can only work inside an iframe");window.addEventListener("message",function(e){switch(e.origin===o.origin&&o.deferred.getContext&&(o.deferred.getContext.resolve(e.data),o.deferred.getContext=null),e.data.type){case"closeWindow":o.trigger("closeWindow","hey");break;case"addButtonClicked":o.trigger("addButtonClicked");break;case"addNewConversation":o.trigger("addNewConversation",e.data)}},!1)}return n.init=function(){return new n(o("origin"),o("instanceId"))},n.prototype.postMessage=function(t){window.top.postMessage(e({instanceId:this.instanceId},t),this.origin)},n.prototype.getContext=function(){return this.deferred.getContext=new t,this.postMessage({type:"getContext"}),this.deferred.getContext.promise},n.prototype.setAppUI=function(e){var t=this;return new Promise(function(o){t.deferred.setAppUI={resolve:o},t.postMessage({type:"setUI",data:e})})},n.prototype.showModal=function(e){void 0===e&&(e={}),this.postMessage({type:"showModal",params:e})},n.prototype.closeModal=function(){this.postMessage({type:"closeModal"})},n.prototype.proxyMessage=function(e,t){void 0===t&&(t={}),this.postMessage({type:"proxyMessage",target:e,data:t})},n.prototype.on=function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)},n.prototype.trigger=function(e){for(var t=this,o=[],n=1;arguments.length>n;n++)o[n-1]=arguments[n];this.events[e]&&this.events[e].forEach(function(e){e.call.apply(e,[t].concat(o))})},n}()});
